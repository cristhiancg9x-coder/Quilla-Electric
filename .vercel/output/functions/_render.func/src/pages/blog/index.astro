---
// src/pages/blog/index.astro
import MainLayout from '@/layouts/MainLayout.astro';
import { getCollection } from 'astro:content';

// 1. Pedimos los art√≠culos y los ordenamos de forma SEGURA
const posts = (await getCollection('blog')).sort((a, b) => {
  const fechaA = a.data.pubDate ? a.data.pubDate.valueOf() : 0;
  const fechaB = b.data.pubDate ? b.data.pubDate.valueOf() : 0;
  return fechaB - fechaA;
});
---

<MainLayout titulo="Blog de Electricidad" descripcion="Consejos y noticias sobre seguridad el√©ctrica en Per√∫.">
  
  <section class="relative py-12 md:py-20 px-4">
    
    <div class="absolute top-0 right-1/2 translate-x-1/2 w-[600px] h-[400px] bg-purple-900/20 blur-[120px] rounded-full -z-10 pointer-events-none"></div>

    <div class="blog-header text-center mb-16 animate-fade-in-down">
      <span class="inline-block py-1 px-3 rounded-full bg-purple-500/10 border border-purple-400/20 text-purple-300 text-xs font-bold tracking-wider mb-4 uppercase">
        Novedades & Consejos
      </span>
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-white">
        Blog <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">El√©ctrico</span>
      </h1>
      <p class="text-slate-400 text-lg max-w-2xl mx-auto">
        Aprende a cuidar tu instalaci√≥n, ahorrar energ√≠a y evitar multas de INDECI.
      </p>
    </div>

    <div class="grid-posts">
      {posts.map((post) => (
        <article class="card-post group">
          <a href={`/blog/${post.id}`} class="link-post">
              <div class="contenido">
                  <div class="header-card">
                      <span class="fecha-badge">
                        üìÖ {post.data.pubDate 
                          ? post.data.pubDate.toLocaleDateString('es-PE', { year: 'numeric', month: 'short', day: 'numeric' }) 
                          : 'Reciente'}
                      </span>
                  </div>

                  <h3 class="group-hover:text-cyan-400 transition-colors">{post.data.title}</h3>
                  
                  <p class="descripcion">{post.data.description}</p>
                  
                  <div class="footer-card">
                      <span class="leer-mas">
                        Leer art√≠culo 
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="arrow-icon"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                      </span>
                  </div>
              </div>
          </a>
        </article>
      ))}
    </div>

  </section>

</MainLayout>

<style>
  /* ANIMACI√ìN DE ENTRADA */
  .animate-fade-in-down {
    animation: fadeInDown 0.8s ease-out forwards;
  }
  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .grid-posts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* --- TARJETA DE CRISTAL (GLASSMORPHISM) --- */
  .card-post {
    background: rgba(255, 255, 255, 0.03); /* Fondo oscuro semitransparente */
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .card-post:hover {
    transform: translateY(-8px);
    border-color: #00f0ff; /* Borde Cian El√©ctrico */
    box-shadow: 0 0 25px rgba(0, 240, 255, 0.15); /* Resplandor */
    background: rgba(255, 255, 255, 0.05);
  }

  .link-post { 
    text-decoration: none; 
    color: inherit; 
    display: flex; 
    flex-direction: column; 
    height: 100%; 
  }
  
  .contenido { 
    padding: 2rem; 
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  .header-card { margin-bottom: 1rem; }

  .fecha-badge {
    font-size: 0.8rem;
    color: #94a3b8;
    background: rgba(255, 255, 255, 0.05);
    padding: 4px 10px;
    border-radius: 50px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  h3 { 
    margin: 0 0 1rem 0; 
    color: white; 
    font-size: 1.5rem; 
    font-weight: 700;
    line-height: 1.3;
  }

  .descripcion { 
    color: #cbd5e1; /* Gris claro (Slate 300) */
    line-height: 1.6; 
    margin-bottom: 2rem; 
    font-size: 0.95rem;
    flex-grow: 1; /* Empuja el footer hacia abajo */
  }
  
  .footer-card {
    margin-top: auto;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  /* ENLACE "LEER M√ÅS" ESTILO NE√ìN */
  .leer-mas { 
    color: #00f0ff; /* Cian */
    font-weight: 700; 
    font-size: 0.9rem; 
    text-transform: uppercase; 
    letter-spacing: 1px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
  }

  .arrow-icon { transition: transform 0.3s; }

  .card-post:hover .arrow-icon { transform: translateX(5px); }
  .card-post:hover .leer-mas { text-shadow: 0 0 8px rgba(0, 240, 255, 0.6); }

</style>